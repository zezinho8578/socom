<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.O.C.O.M.</title>
    <link rel="icon" type="image/png" href="https://www.socom.mil/SOF-ATL/PublishingImages/eSOF-Logo.png">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="js/main.js" defer></script>
</head>
<body>

    <div class="container">
        <!-- All HTML content will be injected by JavaScript from templates -->
    </div>
    
    <div id="skill-tooltip" class="hidden"></div>
    
    <!-- Weapon Preset Modal -->
    <div id="weapon-preset-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>SELECT WEAPON</h2>
                <button onclick="closeWeaponModal()">CLOSE</button>
            </div>
            <div class="modal-controls">
                <label for="weapon-category-select">CATEGORY</label>
                <select id="weapon-category-select" onchange="populateWeaponPresets()"></select>
                <button onclick="addWeapon(null, true)">+ ADD CUSTOM</button>
            </div>
            <hr style="border-color: var(--border-color); margin: 15px 0;">
            <ul id="weapon-preset-list" class="preset-list">
                <!-- Preset items will be injected here by JS -->
            </ul>
        </div>
    </div>
    
    <!-- Armor Modal -->
    <div id="armor-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>SELECT ARMOR</h2>
                <button onclick="closeArmorModal()">CLOSE</button>
            </div>
            <div class="modal-controls">
                <label class="styled-checkbox">
                    <input type="checkbox" id="helmet-checkbox">
                    <span class="checkbox-visual"></span> ADD HELMET (+1 AP)
                </label>
            </div>
            <hr style="border-color: var(--border-color); margin: 15px 0;">
            <ul id="armor-preset-list" class="preset-list">
                <!-- Armor presets will be injected here by JS -->
            </ul>
        </div>
    </div>

    <!-- Skill Improvement Modal -->
    <div id="skill-roll-modal" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <div id="skill-roll-prompt">
                <h2 style="margin-bottom: 20px;">IMPROVE SKILLS?</h2>
                <p style="margin-bottom: 25px;">This should only be done after completing a session. This action is final. Are you sure you want to roll 1d4 for all checked skills?</p>
                <button onclick="executeSkillRolls()">CONFIRM</button>
                <button onclick="closeSkillRollModal()">CANCEL</button>
            </div>
            <div id="skill-roll-process" class="hidden">
                <h3 id="rolling-skill-name" style="margin-bottom: 20px; font-size: 1.2em;"></h3>
                <div id="dice-animation" style="font-size: 4em; font-weight: bold; margin-bottom: 25px; min-height: 60px;">-</div>
                <p id="roll-result-text"></p>
            </div>
            <div id="skill-roll-conclusion" class="hidden">
                <h2 style="margin-bottom: 20px;">CONCLUDED</h2>
                <button onclick="closeSkillRollModal()">CLOSE</button>
            </div>
        </div>
    </div>

    <!-- TEMPLATES FOR DYNAMIC HTML INJECTION -->
    <template id="template-main-container">
        <header class="header"> <img src="https://images.squarespace-cdn.com/content/v1/629e0596d168b365d297c6c4/cea70b06-895e-401c-9669-04fa59cfc5e6/socom-logo.png" alt="SOCOM Logo" class="logo"> <h1>S.O.C.O.M. // AGENT ROSTER</h1> </header>
        <div class="settings-container"> <button id="settings-btn">⚙</button> <div id="settings-menu"> <button onclick="changeTheme('default')">Army (Green)</button> <button onclick="changeTheme('navy')">Navy (Blue)</button> <button onclick="changeTheme('marines')">Marines (Red)</button> <button onclick="changeTheme('airforce')">Air Force (Gray)</button> <button onclick="changeTheme('intelligence')">CIA/NSA (B&W)</button> <button onclick="changeTheme('officer')">Command (Gold)</button> <button onclick="changeTheme('plain')">Plain Mode</button><button id="admin-login-btn" onclick="toggleAdminMode()">Admin Login</button> </div> </div>
        
        <main id="main-view">
            <div class="main-menu">
                <h2>SYSTEM ACCESS</h2>
                
                <div id="daily-briefing" style="margin-bottom: 20px; border: 1px solid var(--border-color); padding: 10px; text-align: left; font-size: 0.9em;">
                    <h3 id="history-title" style="border: none; margin: 0 0 10px 0;">THIS DAY IN HISTORY // SYSTEM DATE</h3>
                    <div style="display: flex; align-items: flex-start; gap: 15px;">
                        <p id="history-content" style="margin: 0; line-height: 1.4; flex: 1;">...LOADING HISTORICAL DATA...</p>
                        <img id="history-image" src="" alt="Historical event" style="width: 220px; max-height: 160px; height: auto; border: 1px solid var(--border-color); object-fit: cover; display: none;">
                    </div>
                </div>

                <button onclick="resetForm(); showView('character-sheet'); ">> CREATE NEW AGENT FILE</button>
                <button onclick="showView('loader')">> LOAD AGENT FILE</button>
                <button onclick="showView('rules')">> RULES</button>
                <button onclick="showView('about')">> ABOUT SOCOM</button>
            </div>
        </main>
        
        <main id="loader-view" class="hidden"> <div class="loader-menu"> <h2>LOAD AGENT</h2> <input type="file" id="json-file-input" accept=".json" onchange="loadCharacterFromFile(event)" class="button"> <h3>LOCAL SAVES</h3> <ul id="saved-sheets-list"></ul> <button onclick="showView('main')">> RETURN</button> </div> </main>
        <main id="character-sheet-view" class="hidden"> <div id="character-sheet-container"> <button onclick="saveCharacter()">SAVE</button><button onclick="screenshotPage(event)">SCREENSHOT</button><button onclick="exportToJson()">EXPORT TO .JSON</button><label id="lock-branch-rank-container" class="styled-checkbox hidden" style="margin-left: 15px;"><input type="checkbox" id="lock-branch-rank-checkbox"><span class="checkbox-visual"></span> LOCK BRANCH/RANK</label> <button onclick="showView('main')">RETURN TO MENU</button> <form id="sheet-form" onsubmit="return false;"></form> </div> </main>
        <main id="rules-view" class="hidden"> 
            <div class="content-menu"> 
                <h2 style="text-align: center;">RULES OF ENGAGEMENT</h2>
                <h2>Be Civil, Be Respectful.</h2> <p>SOCOM is intended to be a dark and intense game, but we're all here to have fun. Horror is in-character and respect is out-of-character. Don't make it personal and don't take things to the heart.</p>
                <h2>About PvP.</h2> <p>Tension between characters happens - distrust, paranoia, and conflicting agendas are part of the setting. But player consent is key before betrayal, sabotage, or character-on-character violence. NEMESIS will not tolerate out-of-character grudges; keep the drama in the game.</p>
                <h2>Communication and Versimilitude.</h2> <p>If you're unsure about something, ask - NEMESIS will always answer. Work with the other players to build suspense and tension and keep the setting immersive. Paranoia is more fun with friends.</p>
                <h2>Death (and Worse) is Part of the Game.</h2> <p>Your character is not a hero, and they are not safe. SOCOM is about failure, creeping dread, and moral collapse with the occasional success. Expect your character to die, disappear, go insane, or worse. When that happens, we'll work together to bring in a new agent.</p>
                <h2>No Metagaming, No Powergaming</h2> <p>Metagaming (using OOC knowledge IC) ruins the experience - act on what your character knows, not what you do. Powergaming (forcing actions on others or breaking realism) doesn't fit this setting. Be prepared for failures and bad choices.</p>
                <h2>Trust NEMESIS, but Question Everything</h2> <p>NEMESIS is not your enemy, but will make your character suffer. If something seems off in the story, that's probably intentional. Keep your eyes open. Assume you're being lied to. And remember that no one is coming to save you.</p>
                <h2 style="text-align: center; font-size: 1.1em;">CONTENT WARNINGS</h2>
                <p>SOCOM Operations will often contain multiple of the contents detailed below:</p>
                <ul> <li>Violence, Gore and Death</li> <li>Torture and Enhanced Interrogation</li> <li>Psychological Horror and Trauma</li> <li>Body Horror</li> <li>Substance Abuse</li> </ul>
                <p>No explicit sexual content is included in SOCOM, although it can be implied/mentioned.</p>
                <div style="text-align: center; margin-top: 30px;"> <button onclick="showView('main')">> RETURN TO MENU</button> </div>
            </div> 
        </main>
        <main id="about-view" class="hidden"> 
            <div class="content-menu">
                <h2 style="text-align: center; margin-bottom: 20px;">ABOUT SOCOM</h2>
                <p>SOCOM is a serialized, operation-based TTRPG using a slightly modified <a href="https://www.deltagreen.com" target="_blank" rel="noopener noreferrer" class="themed-link">Delta Green</a> system set from the 1990s through the 2010s, with most missions unfolding in a post-9/11 world. As America wages covert wars across the globe and at home, a clandestine task force known as N.E.M.E.S.I.S., comprised of elite operatives from the CIA, NSA, and the U.S. military, carries out black ops in the name of national security.</p>
                <p>Players assume the roles of N.E.M.E.S.I.S. agents: psyops, field tacticians, analysts, and infiltrators tasked with counterterrorism, espionage, information warfare, and the moral rot that comes with them.</p>
                <p style="margin-top: 25px;"><em>Inspired by Metal Gear Solid, Call of Duty, Splinter Cell and The Hunt for Red October.</em></p>
                <p style="font-size: 1.2em; text-align: center; font-style: italic; margin-top: 40px; margin-bottom: 20px;"> <a href="https://discord.gg/g8DgxusP9u" target="_blank" rel="noopener noreferrer" class="themed-link">/De Opresso Liber/</a> </p>
                <div style="text-align: center; margin-bottom: 40px;"> <a href="https://www.socom.mil/" target="_blank" rel="noopener noreferrer"> <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/22/SpecialForces_Badge.svg/1200px-SpecialForces_Badge.svg.png" alt="Green Berets Logo" class="logo" style="height: 70px; margin-right: 0;"> </a> </div>
                <div style="text-align: center;"> <button onclick="showView('main')">> RETURN TO MENU</button> </div>
            </div>
        </main>
    </template>

    <template id="template-sheet-form">
        <input type="hidden" id="character-id">
        <section class="form-section"> <h2>IDENTIFICATION</h2> <div class="grid-container" style="grid-template-columns: 1fr 1fr 1fr"> <div><label for="full-name">FULL NAME</label><input type="text" id="full-name"></div> <div><label for="branch">BRANCH</label><select id="branch" onchange="updateRanks()"></select></div> <div><label for="rank">RANK/GRADE</label><select id="rank" onchange="applyAutoTheme()"></select></div> <div><label for="team">TEAM</label><select id="team"><option>SOCOM 1</option><option>SOCOM 2</option><option>SOCOM 3</option><option>SOCOM 4</option><option>SOCOM 5</option><option>SOCOM 6</option></select></div> <div><label for="sex">SEX</label><select id="sex"><option>M</option><option>F</option><option>NA</option></select></div> <div><label for="dob">D.O.B.</label><input type="date" id="dob"></div> <div><label for="nationality">NATIONALITY</label><input type="text" id="nationality"></div> <div><label for="employer">EMPLOYER</label><input type="text" id="employer"></div> <div><label for="education">EDUCATION</label><input type="text" id="education"></div> </div> </section>
        <div class="form-grid"> <div class="col-1"> <section class="form-section"> <div style="display: flex; justify-content: space-between; align-items: center;"><h2>CORE ATTRIBUTES (<span id="stat-points-remaining">25</span> PTS)</h2><button type="button" id="toggle-stats-lock-btn" onclick="toggleStatsLock()" class="hidden">FORCE STATS</button></div> <div id="stats-container" style="display: flex; flex-direction: column; gap: 8px;"></div> </section> <section class="form-section"> <h2>DERIVED ATTRIBUTES</h2> <div class="grid-container" style="grid-template-columns: 1fr 1fr 1fr;"> <div><label>HIT POINTS (HP)</label><div class="derived-attr-input"><input type="number" id="hp-current" min="0"> / <input type="number" id="hp-max" value="0" readonly></div></div> <div><label>ARMOR (AP)</label><div class="derived-attr-input armor-controls"><button type="button" id="armor-btn" onclick="toggleArmor()">△</button><input type="number" id="armor-points" class="hidden" min="0" oninput="validateArmorPoints(event)"></div></div> <div><label>WILLPOWER (WP)</label><div class="derived-attr-input"><input type="number" id="wp-current" min="0"> / <input type="number" id="wp-max" value="0" readonly></div></div> <div><label>SANITY (SAN)</label><div class="derived-attr-input"><input type="number" id="san-current" min="0" oninput="checkBreakingPoint()"> / <input type="number" id="san-max" value="0" readonly></div></div> <div><label>BREAKING PT</label><input type="number" id="bp" readonly></div> </div> <div id="bp-warning" class="hidden"> SAN is at or below Breaking Point! Agent must acquire a new disorder. <button type="button" onclick="acknowledgeBreakingPoint()">ACK & RESET BP</button> </div> </section> <section class="form-section"> <div class="bonds-header" style="display: flex; justify-content: space-between; align-items: center;"> <h2>BONDS (<span id="bond-cha-note"></span>)</h2> <button type="button" onclick="addBond()">+ ADD</button> </div> <div id="bonds-container"></div> </section> <section class="form-section"> <h2 style="text-align: center; border:none; margin-bottom: 5px;">PSYCH PROFILE</h2> <div class="san-loss-container"> <div class="san-loss-group"> <div class="san-loss-label"> <label>VIOLENCE</label><span id="violence-adapted" class="adapted-status hidden">ADAPTED</span> </div> <div> <label class="styled-checkbox"><input type="checkbox" id="violence1" onclick="checkAdaptedStatus()"><span class="checkbox-visual"></span></label> <label class="styled-checkbox"><input type="checkbox" id="violence2" onclick="checkAdaptedStatus()"><span class="checkbox-visual"></span></label> <label class="styled-checkbox"><input type="checkbox" id="violence3" onclick="checkAdaptedStatus()"><span class="checkbox-visual"></span></label> </div> </div> <div class="san-loss-group"> <div class="san-loss-label"> <label>HELPLESSNESS</label><span id="helplessness-adapted" class="adapted-status hidden">ADAPTED</span> </div> <div> <label class="styled-checkbox"><input type="checkbox" id="helplessness1" onclick="checkAdaptedStatus()"><span class="checkbox-visual"></span></label> <label class="styled-checkbox"><input type="checkbox" id="helplessness2" onclick="checkAdaptedStatus()"><span class="checkbox-visual"></span></label> <label class="styled-checkbox"><input type="checkbox" id="helplessness3" onclick="checkAdaptedStatus()"><span class="checkbox-visual"></span></label> </div> </div> </div> </section> </div> <div class="col-2"> <section class="form-section" style="flex-grow: 1; display: flex; flex-direction: column;"> <div style="display: flex; justify-content: space-between; align-items: center;"><h2 style="border-bottom: none;">SKILLS</h2><button type="button" id="roll-skills-btn" class="hidden" onclick="startSkillImprovement()">Roll 1d4s</button></div> <div id="skills-container" style="display: flex; flex-direction: column; gap: 10px; flex-grow: 1;"></div> </section> </div> </div>
        <section class="form-section"> <h2>WEAPONS & EQUIPMENT</h2> <label for="gear">ARMOR AND GEAR</label> <textarea id="gear"></textarea> <label for="notes-field" style="margin-top:10px;">NOTES</label> <textarea id="notes-field"></textarea> <h3 style="margin-top: 15px;">WEAPONS</h3> <table id="weapons-table" style="width:100%; border-collapse: collapse;"> <thead> <tr><th>NAME</th><th>SKILL%</th><th>RANGE</th><th>DMG</th><th>AP</th><th>LETHALITY</th><th>AMMO</th><th></th></tr> </thead> <tbody id="weapons-body"></tbody> </table> <button type="button" onclick="openWeaponModal()">+ ADD WEAPON</button> </section>
    </template>

</body>
</html>
